---
const { label, text, ghlink, demoLink, image, badges } = Astro.props;
import githublogo from "../../assets/github.svg";
import { Image } from "astro:assets";
import type { ImageMetadata } from "astro";

// Type for badge with optional name
type Badge = ImageMetadata | { src: ImageMetadata; name: string };

// Helper to get badge image and name
const getBadgeInfo = (badge: Badge) => {
   if (typeof badge === "object" && "name" in badge) {
      return { image: badge.src, name: badge.name };
   }
   // Fallback: extract name from filename
   const filename = (badge as ImageMetadata).src.split("/").pop() || "";
   const name = filename.replace(/\.(svg|png|jpg)$/, "").replace(/[-_]/g, " ");
   return { image: badge as ImageMetadata, name };
};
---

<article
   class="bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden flex flex-col h-full transition-all duration-300 ease-in-out hover:shadow-2xl hover:-translate-y-1.5 border border-gray-200/80 dark:border-gray-700/60 group"
   aria-label={label}
>
   <a
      href={ghlink}
      target="_blank"
      rel="noopener noreferrer"
      class="block w-full"
      aria-label={`View ${label} project on GitHub`}
   >
      <div class="w-full h-40 sm:h-44 relative">
         <Image
            src={image}
            alt={`Screenshot of ${label} project`}
            class="object-cover w-full h-full"
            widths={[400, 800]}
            sizes="(max-width: 640px) 100vw, 400px"
         />
      </div>
   </a>
   <div class="p-4 sm:p-5 flex flex-col justify-between flex-grow">
      <a
         href={ghlink}
         target="_blank"
         rel="noopener noreferrer"
         class="block"
         aria-label={`Read more about ${label}`}
      >
         <h3
            class="text-lg sm:text-xl font-bold text-gray-900 dark:text-white mb-2 sm:mb-3 leading-tight group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors"
         >
            {label}
         </h3>
         <p
            class="text-sm sm:text-base text-gray-600 dark:text-gray-300 mb-4 sm:mb-5 leading-relaxed line-clamp-3"
         >
            {text}
         </p>
      </a>
      <div class="space-y-3 sm:space-y-4 mt-auto">
         <div
            class="flex flex-wrap gap-2"
            role="list"
            aria-label="Technologies used"
         >
            {
               badges.map((badge: Badge) => {
                  const { image, name } = getBadgeInfo(badge);
                  return (
                     <div role="listitem" class="relative group/tech">
                        <img
                           src={image.src}
                           alt={`${name} technology`}
                           title={name}
                           class="h-6 sm:h-7 w-auto transition-all duration-300 group-hover/tech:scale-125 group-hover/tech:brightness-110 rounded-md"
                        />
                        <div class="absolute -top-9 left-1/2 -translate-x-1/2 bg-gray-900 dark:bg-gray-700 text-white text-xs font-medium rounded-lg py-1.5 px-2.5 opacity-0 group-hover/tech:opacity-100 transition-opacity duration-300 whitespace-nowrap pointer-events-none shadow-lg z-10">
                           {name}
                           <div class="absolute top-full left-1/2 -translate-x-1/2 w-0 h-0 border-x-4 border-x-transparent border-t-4 border-t-gray-900 dark:border-t-gray-700" />
                        </div>
                     </div>
                  );
               })
            }
         </div>
         <div class="flex flex-row justify-between sm:flex-row gap-2 sm:gap-3">
            <a
               href={ghlink}
               target="_blank"
               rel="noopener noreferrer"
               class="inline-flex items-center gap-1.5 text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-200 hover:text-indigo-600 dark:hover:text-indigo-400 transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 rounded-md px-1"
               aria-label={`View ${label} source code on GitHub`}
            >
               <img
                  src={githublogo.src}
                  alt=""
                  aria-hidden="true"
                  class="size-3.5 sm:size-4 dark:invert"
               />
               <span class="font-semibold">View on GitHub</span>
               <span
                  class="transition-transform duration-300 group-hover:translate-x-1"
                  aria-hidden="true">&rarr;</span
               >
            </a>
            {
               demoLink && (
                  <a
                     href={demoLink}
                     target="_blank"
                     rel="noopener noreferrer"
                     class="inline-flex items-center gap-1.5 text-xs sm:text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 dark:bg-indigo-500 dark:hover:bg-indigo-600 px-3 py-1.5 sm:px-4 sm:py-2 rounded-lg transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"
                     aria-label={`View live demo of ${label}`}
                  >
                     <span class="font-semibold">Live Demo</span>
                     <span aria-hidden="true">ðŸš€</span>
                  </a>
               )
            }
         </div>
      </div>
   </div>
</article>
